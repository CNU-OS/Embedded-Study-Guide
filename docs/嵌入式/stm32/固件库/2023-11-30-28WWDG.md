# WWDG

Window watchdog窗口看门狗

本质: 计数器, 可以产生系统复位和唤醒信号

特性: 递减计数器, 递减计数器从0x40减到0x3f的时候会复位(T6跳变为0), 计数器的值大于W[6:0]的时候喂狗会进行复位, 提前唤醒中断EWI(当计数值等于0x40的时候可以产生一个提前唤醒中断)

喂狗: 在窗口期里面重装载, 防止复位

## 作用

用于监测单片机程序运行时效是否精准，主要检测软件异常

用于监测单片机程序运行时效是否精准，主要检测软件异常

![image-20231130205815481](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/image/202311302058556.png)



![image-20231130210602940](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/image/202311302106002.png)

## 寄存器

+ WWDG_CR控制寄存器

![image-20231130210654925](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/image/202311302106966.png)

> 没有重装载寄存器, 直接对这几个位进行操作

+ WWDG_CFR配置寄存器

![image-20231130210927467](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/image/202311302109515.png)

+ WWDG_SR状态寄存器

![image-20231130211040319](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/image/202311302110354.png)

## 超时时间计算

![image-20231130211517491](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/image/202311302115542.png)



![image-20231130224750805](https://picture-01-1316374204.cos.ap-beijing.myqcloud.com/image/202311302247850.png)



对于一般的看门狗，程序可以在它产生复位前的任意时刻刷新看门狗，但是这样有一个隐患，有可能程序跑乱了又跑回正常的地方，或者跑乱的程序正好执行了刷新看门狗操作，这样的情况下一按的看门狗就检测不出来故障了；但是如果使用窗口看门狗，程序员可以根据程序正常执行的时间设置刷新看门狗的一个时间窗口，保证不会提前刷新看门狗，也不会滞后刷新看门狗，这样可以检测出程序没有按照正常的路径运行，非正常地跳过了某些程序段的情况。

WWDG与IWDG的主要区别是有一个窗口控制，WWDG的中断不是用于日常喂狗的，如果用于日常喂狗动作，那WWDG的相对于IWDG，功能也就没什么特别了。WWDG的中断是给程序员最后一次喂狗的机会，一般进入这个中断时，表示你在其他地方安排的喂狗操不能凑效了，而发生这种现象时，肯定是系统有问题了，或者程序有Bug或者干扰，在这种情况下，这个中断时为了让你的程序在发生真正的看门狗复位前，有一个紧急处理的机会，如保存重要数据，或者系统刹车，说白了，就是让CPU写“遗嘱”；








